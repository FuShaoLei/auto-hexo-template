---
title: Androidåˆ¶ä½œåŒäººè”æœºæ¸¸æˆ
date: 2020-05-20 14:25:02
---

> é¡¹ç›®æœ‰æ¶‰åŠåˆ°åŒäººè”æœºæ¸¸æˆçš„æœºåˆ¶ï¼Œè¿™ä¹‹å‰éƒ½æ²¡æœ‰åšè¿‡ç±»ä¼¼çš„ä¸œè¥¿ï¼Œç°åœ¨ä»€ä¹ˆéƒ½æ˜¯ä»é›¶å¼€å§‹ï¼Œæ•…å¼€æ­¤æ–‡è®°å½•

<!--more-->

## å‰è¨€

æˆ‘è§‰å¾—çš„è”æœºæ¸¸æˆæµç¨‹æ˜¯ï¼š
1. ç‚¹å‡»â€œåŒäººæ¸¸æˆâ€
2. è¿›å…¥åŒ¹é…
   - åŒ¹é…å¤±è´¥ğŸ‘‰ç»“æŸ
   - åŒ¹é…æˆåŠŸğŸ‘‰è¿›å…¥3
3. å»ºç«‹å¯é è¿æ¥
4. ç³»ç»Ÿå‡ºé¢˜ï¼ŒåŒæ–¹ç­”é¢˜ï¼Œæ ¹æ®å¯¹é”™å®æ—¶æ›´æ–°ui

å…¶ä¸­2ï¼Œ3æ˜¯æœ€é‡è¦çš„ç‚¹ï¼Œæ‰€è°“å¯é é“¾æ¥ï¼Œéš¾ç‚¹åœ¨äºæ€ä¹ˆæ ·ä½¿ä¸¤ä¸ªçœŸæœºé€šè¿‡æœåŠ¡ç«¯é“¾æ¥ï¼Œè¿™æ—¶æˆ‘æƒ³åˆ°äº†socket ï¼Œè¿™å°±æ¶‰åŠåˆ°ç½‘ç»œä¸­æ€ä¹ˆä¼ è¾“æ•°æ®çš„é—®é¢˜äº†



ç”±äºæ¸¸æˆçš„æ€§è´¨æˆ‘è¿˜è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜

- æ€ä¹ˆä¿è¯é¢˜ç›®çš„ä¸€è‡´æ€§
- å¦‚ä½•è‡ªåŠ¨åŒ¹é…
- æ€ä¹ˆä¿è¯Aæ–¹ä¼ çš„æ•°æ®åˆ°äº†Bæ–¹é‚£é‡Œï¼Ÿ
- æ€ä¹ˆä¿è¯ä¸€ä¸ªå®¢æˆ·ç«¯å°±åŒ¹é…å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¹¶ä¸”ä¸ä¼šè¢«ç¬¬ä¸‰ä¸ªå®¢æˆ·ç«¯åŒ¹é…åˆ°ï¼ˆä¿è¯ä¸€ä¸€å¯¹åº”ï¼‰
- äº’ç›¸ä¹‹é—´è¦ä¼ ä»€ä¹ˆæ•°æ®

é¢ ï¼Œå¥½ä¹±å•Šï¼Œè™½ç„¶ä¸€ç¬é—´è€ƒè™‘äº†é‚£ä¹ˆå¤šï¼Œä½†è¿˜æ˜¯è§‰å¾—æ— ä»ä¸‹æ‰‹ã€‚

æ˜¨å¤©åˆæƒ³åˆ°äº†ä¸€äº›ï¼Œå¯¹äºå¦‚ä½•è‡ªåŠ¨åŒ¹é…ï¼Œæˆ‘æƒ³åˆ°çš„æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯æœ‰ä¼ friendIDçš„è¯ï¼Œåˆ™äºè¿™ä¸ªfriendIDè¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œåˆ™è¿›è¡Œè‡ªåŠ¨åŒ¹é…ã€‚å¥½äº†ï¼Œæ€è€ƒäº†è¿™ä¹ˆå¤šï¼Œè¯¥åŠ¨æ‰‹è¿›è¡Œå®ç°äº†ã€‚é¦–å…ˆ ï¼Œæ˜¯åŒ¹é…æœºåˆ¶çš„å®ç°ã€‚

## åŒ¹é…æœºåˆ¶

é¦–å…ˆï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ä¼šæœ‰**ä¸“å±çš„å”¯ä¸€çš„**ä¸€ä¸ªidï¼Œæˆ‘ä»¬å¯ä»¥ä»¥idè¿›è¡Œæ ‡è¯†ï¼Œè¿™å¤§å¤§æ–¹ä¾¿äº†æˆ‘ä»¬ã€‚

å¥½äº†ï¼Œæƒ³è¦åŒ¹é…ä¸Šï¼Œå¾—å…ˆè¿æ¥ä¸ŠæœåŠ¡å™¨

### è¿›è¡Œç®€å•è¿æ¥æµ‹è¯•

1.androidå®¢æˆ·ç«¯ï¼šåœ¨å­çº¿ç¨‹ä¸­å¯ç”¨socket

```java
private void initSocket() {
        new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    clientSocket=new Socket(IP,PORT);//è¿™ä¸ªipæ˜¯ç”µè„‘çš„ipï¼Œç«¯å£è‡ªå·±å®šçš„
                    if(clientSocket.isConnected()){//è¿›è¡Œç®€å•çš„æµ‹è¯•
                        Log.e("æˆåŠŸï¼","å·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼ï¼");
                    }
                    clientSocket.close();
                }catch (Exception e){
                    e.printStackTrace();
                }
            }
        }).start();
    }
```

2.javaæœåŠ¡ç«¯,

```java
try {
			serverSocket=new ServerSocket(SERVER_PORT);
			System.out.println("æœåŠ¡ç«¯å·²å¯åŠ¨ï¼Œç«¯å£å·æ˜¯: "+SERVER_PORT);
			System.out.println("==========ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ä¸­==========");
			while(true) {
				Socket socket=serverSocket.accept();
				System.out.println("å®¢æˆ·ç«¯å·²è¿æ¥ï¼å®¢æˆ·ç«¯çš„IPåœ°å€æ˜¯:"+socket.getInetAddress());
			}
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
```

ok å…ˆæ‰“å¼€æœåŠ¡ç«¯ï¼Œåæ‰“å¼€å®¢æˆ·ç«¯ï¼Œå…³æ‰windowsé˜²ç«å¢™ï¼Œæˆ‘ä»¬è¿›è¡Œä¸€ä¸‹å°æµ‹è¯•

![æœåŠ¡ç«¯å·²å¯åŠ¨](https://cdn.jsdelivr.net/gh/fushaolei/img/20200524155439.png)

ç„¶åæ‰“å¼€androidç«¯ã€‚

![æµ‹è¯•æˆåŠŸï¼](https://cdn.jsdelivr.net/gh/fushaolei/img/20200524155719.png)

å·²æˆåŠŸè¿æ¥ï¼

åœ¨ç»™æœåŠ¡ç«¯ä¼ ä¸€ä¸ªidè¯•è¯•ã€‚ã€‚

```java
try{
            DataOutputStream writer=new DataOutputStream(clientSocket.getOutputStream());
            writer.writeInt(userId);
        }catch (Exception e){
            e.printStackTrace();
        }
```

æœåŠ¡ç«¯è¿›è¡Œæ¥å—

```java
reader=new DataInputStream(socket.getInputStream());
while(true) {
	int id=reader.readInt();
	System.out.println("è·å–åˆ°å®¢æˆ·ç«¯çš„idæ˜¯ï¼š"+id);
}
```

åŒæ ·ä¹Ÿå¯ä»¥æ¥å—æˆåŠŸã€‚

å¥½äº† ï¼Œæ¥ä¸‹æ¥å¯ä»¥è€ƒè™‘åŒ¹é…çš„é—®é¢˜äº†ã€‚

### å¦‚ä½•åŒ¹é…

é¦–å…ˆï¼Œå°è£…æˆç±»ï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒç”¨ï¼Œç„¶åï¼Œä¸€ä¸ªidå”¯ä¸€å¯¹åº”ä¸€ä¸ªsocket åˆæœ‰å”¯ä¸€çš„friendIDï¼Œåœ¨äº’ä¼ æ•°æ®æ—¶è¦è¿›è¡ŒåŒå‘éªŒè¯ï¼Œä¹Ÿå°±æ˜¯ï¼Œåœ¨åªæœ‰äº’ç›¸æ˜¯å¯¹æ–¹çš„friendIDçš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½äº’å‘æ•°æ®ã€‚
å¦‚ä½•åŒ¹é…ï¼Ÿå½“æœ‰ä¸€ä¸ªæ–°çš„idè¿›å…¥æ—¶ï¼ˆæ¸¸æˆç»“æŸåä¼šåˆ é™¤ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸€ä¸ªæ–°çš„æ¸¸æˆè¯·æ±‚å°±æ˜¯ä¸€ä¸ªæ–°çš„idï¼‰ï¼Œåœ¨è‡ªå®šä¹‰çš„ç±»é‡Œè¿›è¡Œå¾ªç¯ï¼Œå¦‚æœæ²¡æœ‰friendIDåˆ™è¿›è¡ŒåŒ¹é…ï¼Œä¸Šé¢è®²åˆ°äº†ï¼Œå®é™…ä¸Šè¿™é‡ŒåŒ¹é…çš„å®è´¨å°±æ˜¯ï¼š æŠŠfriendIDè®¾ç½®æˆå¯¹æ–¹çš„IDï¼Œä¸çŸ¥é“åœ¨è¿™é‡Œä½ æƒ³æ˜ç™½æ²¡æœ‰ã€‚ï¼ˆå…¶å®è¿™äº›æ˜¯æˆ‘è¾¹å†™æ­¤æ–‡æ—¶è¾¹æƒ³åˆ°çš„ï¼Œå†™å­—æœç„¶èƒ½ä¿ƒè¿›äººçš„æ€è€ƒå•Š(ã€‚ãƒ»âˆ€ãƒ»)ãƒï¼‰

æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ­¥ä¸€æ­¥è¿›è¡Œå®ç°
#### ä¸€ï¼Œæ–°å»ºç±»
```java
package com;

import java.net.Socket;

public class SocketClass {
	private int id;//æœ¬ä½“çš„id
	private int friendid;//å¾…åŒ¹é…id
	private Socket socket;//socket
	
	public SocketClass(int id,Socket socket) {//friendidé»˜è®¤æ˜¯0
		this.id=id;
		this.socket=socket;
	}
	
	public int getId() {
		return id;
	}
	public void setId(int id) {
		this.id = id;
	}
	public int getFriendid() {
		return friendid;
	}
	public void setFriendid(int friendid) {
		this.friendid = friendid;
	}
	public Socket getSocket() {
		return socket;
	}
	public void setSocket(Socket socket) {
		this.socket = socket;
	}

	@Override
	public String toString() {
		return "SocketClass [id=" + id + ", friendid=" + friendid + "]";
	}
}

```

#### äºŒï¼Œæ–°å»ºåŒ¹é…æ–¹æ³•

æ”¾åœ¨è·å–å®¢æˆ·ç«¯idçš„åé¢

```java
reader=new DataInputStream(socket.getInputStream());
while(true) {
	int id=reader.readInt();
	System.out.println("è·å–åˆ°å®¢æˆ·ç«¯çš„idæ˜¯ï¼š"+id);
	socketList.add(new SocketClass(id, socket));//æ·»åŠ è¿›Listé‡Œå»å¤‡ç”¨
	match();//ç”±äºæ˜¯åœ¨whileï¼ˆtrueï¼‰å¾ªç¯é‡Œï¼Œæ‰€ä»¥ä¼šä¸€ç›´ç­‰å¾…åŒ¹é…
} 

```

åŒ¹é…æ–¹æ³•

```java
	//å¼€å§‹åŒ¹é…
	public static void match() {
//		System.out.println(socketList.get(0).toString());//inté»˜è®¤å€¼æ˜¯0
		//å¤§äºæˆ–2æ‰å¼€å§‹ï¼Œå¦åˆ™å°±ä¸èƒ½åŒ¹é…å’¯
		if(socketList.size()>=2) {
			System.out.println("å¼€å§‹åŒ¹é…å‰çš„çŠ¶æ€");
			for(SocketClass mSocket:socketList) {
				System.out.println(mSocket.toString());
			}
			for(int i=0;i<socketList.size();i++) {
				if(socketList.get(i).getFriendid()==0) {
                    //friendId(int)çš„åŸºæœ¬é»˜è®¤å€¼æ˜¯0ï¼Œæ‰€ä»¥ï¼Œå¦‚æœç­‰äº0çš„è¯è¯´æ˜æ²¡æœ‰ï¼Œåˆ™è¿›è¡ŒåŒ¹é…æ“ä½œ
					for(int j=i+1;j<socketList.size();j++) {
						if(socketList.get(j).getFriendid()==0) {
                            //å¦‚æœåœ¨æ­¤å¾ªç¯é‡Œï¼Œä¹Ÿæœ‰ä¸€ä¸ªfriendIdä¸º0çš„è¯ï¼Œå°±è¿›è¡Œä¸¤ä¸¤åŒ¹é…
							socketList.get(i).setFriendid(socketList.get(j).getId());
							socketList.get(j).setFriendid(socketList.get(i).getId());
						}
					}
					
				}
				
			}
			System.out.println("åŒ¹é…åçš„çŠ¶æ€");
		for(SocketClass mSocket:socketList) {
			System.out.println(mSocket.toString());
		}
		}
		
	}
```

æµ‹è¯•ä¸€ä¸‹ï¼Œï¼ŒåŒ¹é…æˆåŠŸï¼ï¼ï¼

![åŒ¹é…æœºåˆ¶æˆåŠŸï¼](https://cdn.jsdelivr.net/gh/fushaolei/img/20200524193753.png)

å–œå¤§æ™®å¥”ã€‚æˆ‘ä»¬ç»ˆäºå®Œæˆäº†åŒ¹é…æœºåˆ¶ï¼Œåˆ°è¿™é‡Œï¼Œåœ¨çœ‹çœ‹å‰è¨€æˆ‘æ‰€å†™çš„ï¼Œæˆ‘ä»¬ç°åœ¨åªå‰©ä¸‹æœ€åä¸€æ­¥äº†ï¼Œæ¥ä¸‹æ¥è¿›å…¥å…³äºæ¸¸æˆuiæ›´æ–°çš„éƒ¨åˆ†ã€‚

## åŒæ­¥UI

è¿™éƒ¨åˆ†ä¹Ÿè›®ç®€å•çš„ï¼ˆæ‰æ€ª~ï¼‰ï¼ŒAæ–¹ç­”é¢˜åæ›´æ–°Aæ–¹çš„UIï¼Œç„¶åæŠŠAçš„å›ç­”ä¼ åˆ°æœåŠ¡å™¨åä¼ ç»™Bæ–¹ä»¥æ›´æ–°Bæ–¹çš„UIï¼ŒBæ–¹åŒæ ·å¦‚æ­¤ï¼Œé‡è¦çš„è¦ä¿è¯é¢˜ç›®ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯ï¼Œå½“æ¯æ¬¡ç­”é¢˜å¼€å§‹æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå‘Aæ–¹Bæ–¹å‘é€é¢˜ç›®ä»¥åŠç­”æ¡ˆã€‚

åŒæ­¥UIè¦èµ°ä»¥ä¸‹æµç¨‹ï¼Œä¸ºäº†ç®€å•è€ƒè™‘ï¼Œå°±å…ˆä¸è€ƒè™‘æœ‰ä¸€æ–¹ä¸­é€”æ¨å‡ºçš„æƒ…å†µäº†ã€‚

1. ï¼ˆä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼‰åŒ¹é…å æœåŠ¡å™¨å‘åŒæ–¹å‘é€å¯¹æ–¹çš„idï¼Œä¸¤å®¢æˆ·ç«¯æ›´æ–°å¯¹æ–¹UIä¿¡æ¯ï¼ˆå¤´åƒå•Šï¼Œåå­—ä¹‹ç±»çš„ï¼‰ï¼ˆå¦‚ä½•ä¿è¯åªå‘é€ä¸€æ¬¡ï¼Ÿï¼‰âœ…
2. ç”±å…¶ä¸­ä¸€æ–¹å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ è¯·æ±‚é¢˜ç›®ï¼ŒæœåŠ¡å™¨åŒæ—¶å‘åŒæ–¹å‘é€é¢˜ç›®ä»¥åŠç­”æ¡ˆâœ…
3. åŒæ–¹å®¢æˆ·ç«¯æ›´æ–°é¢˜ç›®UIâœ…
4. Aæ–¹ç­”é¢˜åï¼Œæ›´æ–°Aæ–¹UI ï¼Œå¹¶æŠŠå›ç­”å‘é€åˆ°æœåŠ¡å™¨è½¬å‘ç»™Bæ–¹
5. Bæ–¹æ¥æ”¶ååˆ¤æ–­å¹¶æ›´æ–°UIï¼ŒåŒä¸Š
6. åç­”å®Œé¢˜çš„äººå‘æœåŠ¡ç«¯å‘é€ä¿¡æ¯è¯·æ±‚é¢˜ç›®ï¼Œé‡å¤ä»¥ä¸Š

è¿™é‡Œå…¶å®æ¶‰åŠåˆ°äº†ä¸€ä¸ªä¼ è¾“é—®é¢˜ï¼Œå¼€å§‹çš„æ—¶å€™ï¼ˆæœåŠ¡ç«¯ï¼‰ç”¨äº†ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„æ–¹æ³•ï¼Œåæ¥äº†è§£åˆ°jsonæ•°æ®ï¼Œå¦‚æœkeyå€¼ä¸å­˜åœ¨çš„è¯ï¼Œå–å¾—çš„æ˜¯nullï¼Œè¿™å°±å¤§å¤§æ–¹ä¾¿äº†æˆ‘ä»¬ï¼Œä»¥jsonä½œä¸ºä¼ è¾“å¯¹è±¡ä¹Ÿå¤§å¤§ç®€åŒ–äº†é€»è¾‘ã€‚æ¯”å¦‚ï¼Œæƒ³æ›´æ–°å¯¹æ–¹çš„uiä¿¡æ¯æ—¶ï¼ŒæœåŠ¡ç«¯ï¼Œä¼ ä¸€ä¸ªkeyä¸ºotherIDå€¼ä¸º19çš„jsonæ•°æ®è¿‡å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯æ¥å—ååˆ¤æ–­keyä¸ºotherIDæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™æ›´æ–°uiï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œå…¶ä»–é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä»¥è¿™ä¸ªkeyä½œä¸ºåˆ¤æ–­æ¡ä»¶ï¼Œåˆ¤æ–­æ‰§è¡Œä»€ä¹ˆé€»è¾‘ï¼Œä¾‹å¦‚æ›´æ–°é¢˜ç›®uiå•Šï¼Œæ¥å—åˆ°å¯¹æ–¹çš„ç­”æ¡ˆå•Šä¹‹ç±»çš„